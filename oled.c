/*
* OledLibrary
*
* Author : Nichita Motoc
*/

#include <avr/io.h>
#include <avr/pgmspace.h> 
#include <util/delay.h>
#include <util/twi.h>
#include <stdint.h>
#include "i2cmaster.h";

#ifndef F_CPU
#define F_CPU 16000000UL
#endif

#define F_SCL 100000UL // SCL frequency
#define Prescaler 1
#define TWBR_val ((((F_CPU / F_SCL) / Prescaler) - 16 ) / 2)

#define letterWidth 12

//addresses used for initialization
#define SSD1306_LCDWIDTH      128
#define SSD1306_LCDHEIGHT      32

#define SSD1306_DEFAULT_ADDRESS 0x78
#define SSD1306_SETCONTRAST 0x81
#define SSD1306_DISPLAYALLON_RESUME 0xA4
#define SSD1306_DISPLAYALLON 0xA5
#define SSD1306_NORMALDISPLAY 0xA6
#define SSD1306_INVERTDISPLAY 0xA7
#define SSD1306_DISPLAYOFF 0xAE
#define SSD1306_DISPLAYON 0xAF
#define SSD1306_SETDISPLAYOFFSET 0xD3
#define SSD1306_SETCOMPINS 0xDA
#define SSD1306_SETVCOMDETECT 0xDB
#define SSD1306_SETDISPLAYCLOCKDIV 0xD5
#define SSD1306_SETPRECHARGE 0xD9
#define SSD1306_SETMULTIPLEX 0xA8
#define SSD1306_SETLOWCOLUMN 0x00
#define SSD1306_SETHIGHCOLUMN 0x10
#define SSD1306_SETSTARTLINE 0x40
#define SSD1306_MEMORYMODE 0x20
#define SSD1306_COLUMNADDR 0x21
#define SSD1306_PAGEADDR   0x22
#define SSD1306_COMSCANINC 0xC0
#define SSD1306_COMSCANDEC 0xC8
#define SSD1306_SEGREMAP 0xA0
#define SSD1306_CHARGEPUMP 0x8D
#define SSD1306_SWITCHCAPVCC 0x2
#define SSD1306_NOP 0xE3
#define SSD1306_DEACTIVATE_SCROLL 0x2E

//font
const PROGMEM  uint16_t fNull[] = {};
const PROGMEM  uint16_t fA[] = {108,5,1,6,1,4,2,5,2,6,2,7,2,4,3,5,3,6,3,7,3,3,4,3,5,3,6,4,6,4,5,4,4,7,4,7,5,7,6,8,6,8,5,8,4,2,7,2,8,2,9,3,9,3,8,3,7,8,7,8,8,8,9,9,9,9,8,9,7,4,8,5,8,6,8,7,8,4,9,5,9,7,9,6,9,1,10,2,10,2,11,2,12,1,12,1,11,9,10,9,11,9,12,10,12,10,11,10,10};
const PROGMEM  uint16_t fB[] = {160,1,1,2,1,1,2,2,2,1,3,2,3,1,4,2,4,1,5,2,5,1,6,2,6,1,7,2,7,1,8,2,8,1,9,2,9,1,10,2,10,2,11,1,11,2,12,1,12,3,1,4,1,5,1,6,1,7,1,3,2,4,2,5,2,6,2,7,2,8,1,8,2,8,3,9,2,9,3,9,4,10,3,10,4,10,5,9,5,9,6,9,7,8,5,8,6,7,6,8,7,7,7,6,7,6,6,5,6,3,6,4,6,3,7,4,7,5,7,3,12,3,11,4,11,4,12,5,12,6,12,6,11,5,11,7,12,7,11,8,12,8,11,8,10,8,8,9,8,9,9,9,10,9,11,10,10,10,9,10,8};
const PROGMEM  uint16_t fC[] = {104,1,4,2,3,3,2,4,1,1,5,1,6,1,7,1,8,1,9,2,10,3,11,4,12,2,4,2,5,2,6,2,7,2,8,2,9,3,4,3,3,4,3,4,2,5,2,5,1,6,2,6,1,7,2,7,1,8,1,8,2,9,1,9,2,10,2,10,3,9,3,3,10,3,9,4,11,4,10,5,11,6,11,7,11,5,12,6,12,7,12,8,12,8,11,9,12,9,11,9,10,10,11,10,10};
const PROGMEM  uint16_t fD[] = {132,1,1,1,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,11,1,12,2,12,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,1,2,2,2,3,3,1,4,1,5,1,6,1,7,1,3,2,4,2,5,2,6,2,7,2,3,12,4,12,5,12,6,12,7,12,7,11,6,11,5,11,4,11,3,11,7,3,8,2,8,3,8,4,9,3,9,4,9,5,10,4,10,5,10,6,10,7,10,8,7,10,8,9,8,10,8,11,9,8,9,9,9,10,9,6,9,7,10,9};
const PROGMEM  uint16_t fE[] = {136,1,1,1,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,11,1,12,2,12,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,9,2,8,2,3,2,4,2,5,2,6,2,7,2,10,2,3,12,4,12,5,12,6,12,7,12,8,12,9,12,10,12,10,11,9,11,8,11,7,11,6,11,5,11,4,11,3,11,3,6,3,7,4,6,5,6,6,6,4,7,5,7,6,7,7,6,7,7,8,6,8,7};
const PROGMEM  uint16_t fF[] = {104,1,1,1,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,11,1,12,2,12,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,9,2,8,2,3,2,4,2,5,2,6,2,7,2,10,2,3,6,3,7,4,6,5,6,6,6,4,7,5,7,6,7,7,6,7,7,8,6,8,7};
const PROGMEM  uint16_t fG[] = {130,1,4,1,5,1,6,1,7,1,8,1,9,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,4,1,5,1,6,1,7,1,8,1,9,1,9,2,8,2,3,2,4,2,5,2,6,2,7,2,10,2,3,11,4,12,3,3,3,4,4,3,9,3,10,3,3,10,3,9,4,11,4,10,8,11,8,12,5,12,6,12,7,12,7,11,6,11,5,11,8,10,9,11,9,10,10,10,10,9,7,6,7,7,8,6,8,7,9,6,9,7,10,6,10,7,10,8,9,9,9,8,6,6,6,7};
const PROGMEM  uint16_t fH[] = {120,1,4,1,5,1,6,1,7,1,8,1,9,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,9,1,9,2,10,2,9,3,10,3,9,11,9,10,10,10,10,9,7,6,7,7,9,6,9,7,10,6,10,7,10,8,9,9,9,8,6,6,6,7,2,12,2,11,1,11,1,10,1,12,1,3,1,2,1,1,2,1,2,2,10,1,9,4,9,5,10,5,10,4,10,11,10,12,9,12,8,6,5,6,4,6,3,6,3,7,4,7,5,7,8,7};
const PROGMEM  uint16_t fI[] = {96,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,2,2,3,2,4,2,5,2,6,2,7,2,8,2,9,2,5,3,5,4,5,5,6,3,6,4,6,5,6,6,5,6,5,7,6,7,5,8,6,8,5,9,6,9,5,10,6,10,5,11,6,11,5,12,6,12,4,11,3,11,2,11,2,12,3,12,4,12,7,12,8,12,9,12,9,11,8,11,7,11};
const PROGMEM  uint16_t fJ[] = {88,7,1,8,1,9,1,7,2,8,2,9,2,5,11,6,11,5,12,6,12,4,11,3,11,2,11,3,12,4,12,7,11,1,10,1,9,2,9,2,10,3,10,6,10,7,10,8,10,7,9,8,9,8,8,7,8,7,7,8,6,8,5,7,5,7,6,8,7,7,4,7,3,8,4,8,3,10,1,10,2,6,2,6,1,5,1,5,2};
const PROGMEM  uint16_t fK[] = {120,1,2,1,3,1,1,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,11,1,12,2,12,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,2,1,3,7,3,6,4,6,4,7,5,5,5,6,5,7,5,8,6,5,6,6,6,7,6,8,6,9,6,4,7,3,7,4,7,5,8,2,8,3,8,4,9,1,9,2,10,1,10,2,9,3,7,8,7,9,7,10,8,9,8,10,8,11,9,10,9,11,9,12,10,11,10,12};
const PROGMEM  uint16_t fL[] = {80,1,2,1,3,1,1,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,11,1,12,2,12,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,2,1,3,12,4,12,5,12,6,12,7,12,8,12,9,12,10,12,9,11,8,11,7,11,6,11,5,11,4,11,3,11,10,11};
const PROGMEM  uint16_t fM[] = {136,1,4,1,5,1,6,1,7,1,8,1,9,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,9,1,9,2,10,2,9,3,10,3,9,11,9,10,10,10,10,9,9,6,9,7,10,6,10,7,10,8,9,9,9,8,2,12,2,11,1,11,1,10,1,12,1,3,1,2,1,1,2,1,2,2,10,1,9,4,9,5,10,5,10,4,10,11,10,12,9,12,3,2,3,3,3,4,4,3,4,4,4,5,8,2,8,3,8,4,7,3,7,4,7,5,5,4,6,4,5,5,6,5,5,6,6,6,5,7,6,7};
const PROGMEM  uint16_t fN[] = {140,1,4,1,5,1,6,1,7,1,8,1,9,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,9,1,9,2,10,2,9,3,10,3,9,11,9,10,10,10,10,9,9,6,9,7,10,6,10,7,10,8,9,9,9,8,2,12,2,11,1,11,1,10,1,12,1,3,1,2,1,1,2,1,2,2,10,1,9,4,9,5,10,5,10,4,10,11,10,12,9,12,3,2,3,3,3,4,4,3,4,4,4,5,5,4,5,5,4,6,5,6,5,7,8,11,8,10,8,9,7,10,7,9,7,8,7,7,6,9,6,8,6,7,6,6};
const PROGMEM  uint16_t fO[] = {128,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,3,12,4,12,5,12,6,12,7,12,8,12,9,11,8,11,7,11,6,11,5,11,4,11,3,11,3,10,3,1,3,2,3,3,4,2,4,1,5,1,5,2,6,2,6,1,7,1,8,1,7,2,8,2,10,10,10,9,10,8,10,7,10,6,10,5,10,4,10,3,9,2,9,3,9,4,9,5,9,6,9,7,9,8,9,9,9,10,8,3,8,10};
const PROGMEM  uint16_t fP[] = {120,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,3,1,3,2,4,2,4,1,5,1,5,2,6,2,6,1,7,1,8,1,7,2,8,2,10,6,10,5,10,4,10,3,9,2,9,3,9,4,9,5,9,6,9,7,8,3,2,12,1,12,1,11,2,1,1,1,1,2,3,7,3,8,4,8,5,8,6,8,4,7,5,7,6,7,8,7,7,7,7,8,8,8,8,6};
const PROGMEM  uint16_t fQ[] = {148,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,3,1,3,2,4,2,4,1,5,1,5,2,6,2,6,1,7,1,8,1,7,2,8,2,10,6,10,5,10,4,10,3,9,2,9,3,9,4,9,5,9,6,9,7,8,3,3,12,3,11,4,11,4,12,3,3,3,10,5,11,6,11,5,12,6,12,10,7,10,8,10,9,9,8,9,9,7,11,8,11,10,12,9,12,9,11,10,11,9,10,7,12,8,10,7,10,7,9,8,9,6,9,6,8,7,8,5,8,5,7,6,7};
const PROGMEM  uint16_t fR[] = {140,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,2,11,2,10,2,9,2,8,2,7,2,6,2,5,2,4,2,3,2,2,3,1,3,2,4,2,4,1,5,1,5,2,6,2,6,1,7,1,8,1,7,2,8,2,10,6,10,5,10,4,10,3,9,2,9,3,9,4,9,5,9,6,9,7,8,3,9,9,10,12,9,12,9,11,10,11,9,10,8,10,7,9,8,9,6,8,7,8,1,11,1,12,2,12,1,2,1,1,2,1,8,6,8,7,7,7,8,8,3,8,3,7,4,7,5,7,6,7,4,8,5,8,10,10};
const PROGMEM  uint16_t fS[] = {136,2,2,1,3,3,1,1,4,1,5,2,6,3,7,4,7,1,9,2,9,1,10,2,10,3,10,3,11,2,11,3,12,4,12,4,11,5,11,5,12,6,11,6,12,7,11,7,12,8,10,8,11,8,12,9,11,9,10,9,9,10,10,10,9,10,8,9,8,9,7,8,8,8,7,8,6,5,7,7,7,6,7,7,6,6,6,5,6,4,6,3,6,3,5,2,5,2,4,2,3,3,3,3,2,4,2,5,2,6,2,7,2,4,1,5,1,6,1,7,1,8,1,8,2,8,3,9,2,9,3,9,4,10,3,10,4};
const PROGMEM  uint16_t fT[] = {80,1,2,1,1,2,2,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,10,2,9,2,8,2,3,2,4,2,5,2,6,2,7,2,5,3,6,3,5,4,6,4,5,5,5,6,5,7,5,8,5,9,5,10,5,11,5,12,6,12,6,11,6,10,6,9,6,8,6,7,6,6,6,5};
const PROGMEM  uint16_t fU[] = {112,1,1,1,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,2,11,3,12,2,1,2,2,2,3,2,4,2,5,2,6,2,7,2,8,2,9,2,10,3,11,3,10,4,12,4,11,5,12,5,11,6,12,6,11,7,12,7,11,8,12,8,11,9,11,10,10,10,9,10,8,10,7,10,6,10,5,10,4,10,3,10,2,10,1,9,1,9,2,9,3,9,4,9,5,9,6,9,7,9,8,9,9,9,10,8,10};
const PROGMEM  uint16_t fV[] = {104,1,1,1,2,1,3,1,4,2,1,2,2,2,3,2,4,2,5,2,6,2,7,3,10,4,11,5,12,5,11,6,12,6,11,7,11,10,4,10,3,10,2,10,1,9,1,9,2,9,3,9,4,9,5,9,6,8,10,3,4,3,5,3,6,3,7,3,8,3,9,4,7,4,8,4,9,4,10,5,10,6,10,7,10,7,9,7,8,7,7,8,9,8,8,8,7,8,6,8,5,8,4,9,7};
const PROGMEM  uint16_t fW[] = {124,1,1,1,2,1,3,1,4,2,1,2,2,2,3,2,4,2,5,2,6,2,7,3,10,4,11,5,11,6,11,7,11,10,4,10,3,10,2,10,1,9,1,9,2,9,3,9,4,9,5,9,6,8,10,3,6,3,7,3,8,3,9,4,10,5,10,6,10,7,10,8,9,8,8,8,7,8,6,8,5,9,7,4,12,7,12,3,5,2,8,3,12,3,11,1,5,2,9,8,12,8,11,9,9,9,8,10,5,6,6,5,6,5,7,6,7,6,8,6,9,5,9,5,8};
const PROGMEM  uint16_t fX[] = {120,1,1,1,2,1,3,2,1,2,2,2,3,2,4,3,10,10,3,10,2,10,1,9,1,9,2,9,3,9,4,8,10,3,8,3,9,8,9,8,8,8,5,3,5,2,9,9,9,6,6,5,6,5,7,6,7,6,8,5,8,1,12,2,12,9,12,10,12,10,11,10,10,9,10,2,10,1,10,1,11,2,11,9,11,7,8,7,6,7,7,7,9,4,5,8,3,3,3,3,4,5,5,4,7,4,9,4,6,4,4,4,8,6,5,7,4,7,5,8,4};
const PROGMEM  uint16_t fY[] = {92,1,1,1,2,1,3,2,1,2,2,2,3,2,4,10,3,10,2,10,1,9,1,9,2,9,3,9,4,8,5,3,5,5,7,6,7,6,8,5,8,7,6,4,5,8,3,3,3,3,4,4,7,4,6,7,5,8,4,7,7,5,9,6,9,9,5,8,6,8,7,7,8,6,10,6,11,6,12,5,12,5,11,5,10,4,8,3,7,3,6,2,5};
const PROGMEM  uint16_t fZ[] = {124,1,1,1,2,2,2,2,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,10,2,9,2,3,2,4,2,5,2,6,2,7,2,8,2,1,11,1,12,2,11,3,11,4,11,5,11,6,11,7,11,8,11,9,11,2,12,3,12,4,12,5,12,6,12,7,12,8,12,10,11,10,12,9,12,9,3,8,3,9,4,8,4,7,4,2,10,3,10,2,9,3,9,4,9,3,8,4,8,5,8,4,7,5,7,6,7,5,6,6,6,7,6,6,5,7,5,8,5};
const PROGMEM  uint16_t f0[] = {160,2,2,3,1,4,1,5,1,6,1,7,1,8,1,9,2,3,2,4,2,5,2,6,2,7,2,8,2,2,11,3,11,4,11,5,11,6,11,7,11,8,11,9,11,3,12,4,12,5,12,6,12,7,12,8,12,10,10,10,9,10,8,10,7,10,6,10,5,10,4,10,3,1,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,2,3,2,4,2,5,2,6,2,8,2,7,2,9,2,10,9,9,9,8,9,10,9,6,9,7,9,5,9,4,9,3,3,10,3,9,3,8,4,9,4,8,4,7,5,8,5,7,5,6,6,6,6,7,6,5,7,6,7,5,7,4,8,5,8,4,8,3,3,3,8,10};
const PROGMEM  uint16_t f1[] = {90,2,12,3,12,4,12,5,12,6,12,7,12,8,12,9,12,2,11,3,11,5,11,6,11,7,11,8,11,9,11,4,11,5,10,5,9,5,7,5,5,5,4,5,3,5,6,5,8,6,10,6,9,6,8,6,7,6,6,6,5,6,4,6,3,6,2,6,1,5,1,5,2,4,2,4,3,4,4,3,3,3,4,3,5,2,4,2,5,2,6};
const PROGMEM  uint16_t f2[] = {132,2,12,3,12,4,12,5,12,6,12,7,12,8,12,9,12,2,11,3,11,5,11,6,11,7,11,8,11,9,11,4,11,1,11,1,12,10,11,10,12,1,10,2,10,3,10,2,9,3,9,4,9,3,8,4,8,5,8,6,8,4,7,5,7,6,7,7,7,8,7,6,6,7,6,8,6,9,6,8,5,9,5,10,5,10,4,9,4,10,3,9,3,8,3,9,2,8,2,7,2,6,2,5,2,4,2,3,2,8,1,7,1,6,1,5,1,4,1,3,1,2,2,1,3,1,4,2,4,2,3,3,3};
const PROGMEM  uint16_t f3[] = {124,3,12,4,12,5,12,6,12,7,12,2,11,3,11,5,11,6,11,7,11,8,11,9,11,4,11,1,10,2,10,3,10,6,6,7,6,8,6,9,6,8,5,9,5,10,5,10,4,9,4,10,3,9,3,8,3,9,2,8,2,7,2,6,2,5,2,4,2,3,2,8,1,7,1,6,1,5,1,4,1,3,1,2,2,1,3,1,4,2,4,2,3,3,3,5,6,5,7,6,7,7,7,8,7,9,7,8,8,9,8,10,8,9,9,10,9,8,10,9,10,10,10,8,12};
const PROGMEM  uint16_t f4[] = {114,1,6,1,9,7,12,8,12,8,11,8,10,8,9,8,8,8,7,8,6,8,5,8,4,8,3,8,2,8,1,7,1,7,2,7,3,7,4,7,5,7,6,7,7,7,8,7,9,7,10,7,11,6,1,6,2,6,3,5,2,5,3,5,4,4,3,4,4,4,5,3,4,3,5,3,6,2,5,2,6,2,7,1,7,1,8,2,8,2,9,3,9,4,9,5,9,6,9,3,8,4,8,5,8,6,8,9,9,10,9,9,8,10,8};
const PROGMEM  uint16_t f5[] = {140,7,12,8,12,10,9,10,8,9,11,10,10,3,12,2,11,1,10,4,12,5,12,6,12,3,11,4,11,5,11,6,11,8,11,7,11,2,10,3,10,2,9,1,9,9,10,8,10,9,9,9,8,10,7,9,7,8,7,9,6,8,6,7,6,6,6,5,6,4,6,3,6,2,6,1,6,8,5,7,5,6,5,5,5,4,5,3,5,2,5,1,5,2,4,2,3,2,2,2,1,1,2,1,1,1,3,1,4,3,1,4,1,5,1,6,1,7,1,8,1,9,1,10,1,10,2,9,2,8,2,5,2,6,2,7,2,4,2,3,2};
const PROGMEM  uint16_t f6[] = {142,7,12,8,12,10,9,10,8,9,11,10,10,3,12,2,11,1,10,4,12,5,12,6,12,3,11,4,11,5,11,6,11,8,11,7,11,2,10,3,10,2,9,1,9,9,10,8,10,9,9,9,8,10,7,9,7,8,7,9,6,8,6,7,6,6,6,5,6,4,6,3,6,2,6,1,6,8,5,7,5,6,5,5,5,4,5,2,5,1,5,2,3,2,2,1,3,1,4,3,1,4,1,5,1,6,1,7,1,8,2,5,2,6,2,7,2,4,2,3,2,1,7,1,8,2,7,2,8,3,7,9,3,8,3,8,1,9,2,2,4,3,3};
const PROGMEM  uint16_t f7[] = {92,1,1,1,2,1,3,2,3,2,2,2,1,3,2,4,2,5,2,3,1,5,1,6,1,4,1,7,1,8,1,9,1,10,1,6,2,7,2,8,2,9,2,10,2,9,3,9,4,8,3,8,4,8,5,8,6,7,4,7,5,7,6,7,7,7,8,6,6,6,7,6,8,6,9,6,10,5,8,5,9,5,10,5,11,5,12,4,12,4,11,4,10};
const PROGMEM  uint16_t f8[] = {140,2,3,2,2,3,2,4,2,5,2,3,1,5,1,6,1,4,1,7,1,8,1,6,2,7,2,8,2,9,2,5,11,5,12,4,12,4,11,1,7,1,8,1,9,1,10,2,11,3,12,3,11,2,10,2,9,2,8,2,7,2,6,2,4,9,7,9,8,9,9,10,8,10,7,9,4,9,3,9,6,10,9,10,10,9,10,9,11,8,11,7,11,6,11,6,12,7,12,8,12,3,3,3,4,3,5,3,6,3,7,8,3,8,4,8,5,8,6,8,7,4,5,5,5,6,5,7,5,7,6,6,6,5,6,4,6,3,10,8,10};
const PROGMEM  uint16_t f9[] = {146,2,3,2,2,3,2,4,2,5,2,3,1,5,1,6,1,4,1,7,1,8,1,6,2,7,2,8,2,9,2,5,11,5,12,4,12,4,11,1,10,2,11,3,12,3,11,2,10,2,7,2,6,2,4,9,7,9,8,9,9,10,8,10,7,9,4,9,3,9,6,10,9,10,10,9,10,9,11,8,11,7,11,6,11,6,12,7,12,8,12,3,3,3,6,3,7,8,3,8,6,8,7,8,10,2,5,1,4,1,3,1,5,1,6,10,3,10,4,10,5,10,6,9,5,1,11,2,12,5,7,4,7,5,8,6,8,7,7,6,7,7,8,3,8,4,8};
const PROGMEM  uint16_t fEqual[] = {64,2,4,9,8,9,9,9,4,2,5,9,5,5,8,6,8,7,8,3,8,4,8,7,9,6,9,5,9,4,9,3,9,2,9,2,8,8,9,8,8,8,5,8,4,3,4,3,5,4,4,7,5,6,5,5,4,4,5,6,4,7,4,5,5};
const PROGMEM  uint16_t fDash[] = {24,5,6,6,6,6,7,5,7,4,6,4,7,3,6,3,7,7,6,7,7,8,6,8,7};
const PROGMEM  uint16_t fColon[] = {16,6,9,5,9,5,4,6,4,5,3,6,3,5,10,6,10};
const PROGMEM  uint16_t fDot[] = {8,5,11,5,12,6,12,6,11};


uint8_t display_buffer[512];

//used internally
void ssd1306_command(uint8_t command) {
	i2c_start(SSD1306_DEFAULT_ADDRESS);
	i2c_write(0x00);
	i2c_write(command);
	i2c_stop();
}

//initialization function
void oled_init(void) {
	
	ssd1306_command(SSD1306_DISPLAYOFF);                  

	ssd1306_command(SSD1306_SETDISPLAYCLOCKDIV);            
	ssd1306_command(0x80);                
	
	ssd1306_command(SSD1306_SETMULTIPLEX);                  
	ssd1306_command(0x1F);
	
	ssd1306_command(SSD1306_SETDISPLAYOFFSET);              
	ssd1306_command(0x00);                                  
	
	ssd1306_command(SSD1306_SETSTARTLINE);      
	
	ssd1306_command(SSD1306_CHARGEPUMP);                    
	ssd1306_command(0x14); 
	
	ssd1306_command(SSD1306_MEMORYMODE);                
	ssd1306_command(0x00);      
	
	ssd1306_command(SSD1306_SEGREMAP | 0x1); 
	
	ssd1306_command(SSD1306_COMSCANDEC); 
	
	ssd1306_command(SSD1306_SETCOMPINS);                   
	ssd1306_command(0x02);
	
	ssd1306_command(SSD1306_SETCONTRAST);                
	ssd1306_command(0x8f);
	
	ssd1306_command(SSD1306_SETPRECHARGE);                  
	ssd1306_command(0xF1);
	
	ssd1306_command(SSD1306_SETVCOMDETECT);              
	ssd1306_command(0x40);
	
	ssd1306_command(SSD1306_DISPLAYALLON_RESUME);          
	
	ssd1306_command(SSD1306_NORMALDISPLAY);                 

	ssd1306_command(SSD1306_DEACTIVATE_SCROLL);
	
	ssd1306_command(SSD1306_DISPLAYON);                   
}

//used internally
void setColAddress()
{
	ssd1306_command(SSD1306_COLUMNADDR);
	ssd1306_command(0); 
	ssd1306_command(SSD1306_LCDWIDTH-1); 
}
void setPageAddress()
{
	ssd1306_command(SSD1306_PAGEADDR); 
	ssd1306_command(0); 
	ssd1306_command((SSD1306_LCDHEIGHT/8)-1);
}
//-------------

// transfers the array
void display()
{
	uint16_t j=0;
	
	// set the Column and Page addresses to 0,0
	setColAddress();
	setPageAddress();
	
	i2c_start(SSD1306_DEFAULT_ADDRESS);
	i2c_write(0X40); 
	for(j=0;j<512;j++)
	{
		i2c_write(display_buffer[j]);
	}

	i2c_stop();
}

//clears the array
void clear(){
	for(int i=0;i<512;i++)
	display_buffer[i] = 0;
}

//fills the array
void fill(){
	for(int i=0;i<512;i++)
	display_buffer[i] = 0xFF;
}

// allows you to draw a pixel using x,y coordinates
// x = [1..128]
// y = [1..32]
void drawPixel(int x, int y){
	if(x<1 || x>128 || y<1 || y>32) return;
	
	x = x-1;
	y = y-1;
	
	display_buffer[128*(y / 8) + x] = display_buffer[128*(y / 8) + x] | 1<<(y%8);
}

//used by drawFromList
void drawFromNumber(int num){
	if(num<0 || num>4095) return;
	display_buffer[num/8] = display_buffer[num/8] | 1<<(num%8);
}

//used for images
void drawFromList(uint16_t a[]){
	for(int i=1;i<=pgm_read_word_near(a);i++)
	drawFromNumber(pgm_read_word_near(a+i));
}

//used internally to display the font
void drawFromXYList(uint16_t a[],int offsetX,int offsetY){
	for(int i=1;i<=pgm_read_word_near(a);i+=2){
		drawPixel(pgm_read_word_near(a+i)+offsetX,pgm_read_word_near(a+i+1)+offsetY);
	}
}


//functions for float to string conversion
void reverse(char* str, int len)
{
	int i = 0, j = len - 1, temp;
	while (i < j) {
		temp = str[i];
		str[i] = str[j];
		str[j] = temp;
		i++;
		j--;
	}
}

int intToStr(int x, char str[], int d)
{
	int i = 0;
	while (x) {
		str[i++] = (x % 10) + '0';
		x = x / 10;
	}
	
	while (i < d)
	str[i++] = '0';
	
	reverse(str, i);
	str[i] = '\0';
	return i;
}

void ftoa(float n, char* res, int afterpoint)
{
	int ipart = (int)n;

	float fpart = n - (float)ipart;
	
	int i = intToStr(ipart, res, 0);
	
	if (afterpoint != 0) {
		res[i] = '.'; 
		
		fpart = fpart * pow(10, afterpoint);
		
		intToStr((int)fpart, res + i + 1, afterpoint);
	}
}
//---------

//font
uint16_t getCh(char c){
	uint16_t toChar;
	switch(c){
		case 'A':
		toChar = &fA;
		break;
		case 'B':
		toChar = &fB;
		break;
		case 'C':
		toChar = &fC;
		break;
		case 'D':
		toChar = &fD;
		break;
		case 'E':
		toChar = &fE;
		break;
		case 'F':
		toChar = &fF;
		break;
		case 'G':
		toChar = &fG;
		break;
		case 'H':
		toChar = &fH;
		break;
		case 'I':
		toChar = &fI;
		break;
		case 'J':
		toChar = &fJ;
		break;
		case 'K':
		toChar = &fK;
		break;
		case 'L':
		toChar = &fL;
		break;
		case 'M':
		toChar = &fM;
		break;
		case 'N':
		toChar = &fN;
		break;
		case 'O':
		toChar = &fO;
		break;
		case 'P':
		toChar = &fP;
		break;
		case 'Q':
		toChar = &fQ;
		break;
		case 'R':
		toChar = &fR;
		break;
		case 'S':
		toChar = &fS;
		break;
		case 'T':
		toChar = &fT;
		break;
		case 'U':
		toChar = &fU;
		break;
		case 'V':
		toChar = &fV;
		break;
		case 'W':
		toChar = &fW;
		break;
		case 'X':
		toChar = &fX;
		break;
		case 'Y':
		toChar = &fY;
		break;
		case 'Z':
		toChar = &fZ;
		break;
		case '0':
		toChar = &f0;
		break;
		case '1':
		toChar = &f1;
		break;
		case '2':
		toChar = &f2;
		break;
		case '3':
		toChar = &f3;
		break;
		case '4':
		toChar = &f4;
		break;
		case '5':
		toChar = &f5;
		break;
		case '6':
		toChar = &f6;
		break;
		case '7':
		toChar = &f7;
		break;
		case '8':
		toChar = &f8;
		break;
		case '9':
		toChar = &f9;
		break;
		case ':':
		toChar = &fColon;
		break;
		case '=':
		toChar = &fEqual;
		break;
		case '-':
		toChar = &fDash;
		break;
		case '.':
		toChar = &fDot;
		break;
		default:
		toChar = &f0;
		break;
	}
	return toChar;
}

//abs
float absolute(float n){
	if(n<0) return -n;
	return n;
}

//prints a float
//line = [1..2]
//pos = [1..10]
//sLen - how many characters you would like your float to occupy
//num - the actual float
void oledPrintFloat(int line, int pos,int sLen,float num){
	if(line<1 || line>2 || pos<1 || pos>10) return;
	char s[12];
	ftoa(absolute(num),s,2);
	if(num<0){
		for(int j = sLen-1;j>=0;j--)
			s[j+1] = s[j]; 
		s[0] = '-';
	}
	uint16_t toChar;
	for(int i=0;i<sLen;i++){
		toChar = getCh(s[i]);
		drawFromXYList(toChar,(pos+i-1)*letterWidth,(line-1)*16+1);
	}
}

//prints an array of chars
//line = [1..2]
//pos = [1..10]
//sLen - how many characters you would like your array of chars to occupy
//s[] - the actual array
//recognized characters ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789=-:.
void oledPrintString(int line, int pos,int sLen, char s[]){
	if(line<1 || line>2 || pos<1 || pos>10) return;
	
	uint16_t toChar;
	for(int i=0;i<sLen;i++){
		toChar = getCh(s[i]);
		drawFromXYList(toChar,(pos+i-1)*letterWidth,(line-1)*16+1);
	}
	
}
